<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
  <title>Dashboard - Bradley's Financial Tools</title>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Favicon and Manifest -->
  <link rel="icon" href="/icons/icon-192.png" type="image/png" />
  <link rel="manifest" href="/manifest.json" />

  <!-- iOS PWA Support -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="VB Toolkit">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">
  <!-- Removed missing icon references to prevent 404 errors -->

  <!-- Theme Color for Android + iOS -->
  <meta name="theme-color" content="#007bff">

  <!-- CRITICAL: Unregister service worker IMMEDIATELY before any scripts load -->
  <script>
    // Run this IMMEDIATELY, before service worker can intercept anything
    (function() {
      if ('serviceWorker' in navigator) {
        // Unregister ALL service workers immediately
        navigator.serviceWorker.getRegistrations().then(registrations => {
          for (let registration of registrations) {
            registration.unregister();
            console.log('[SW] Emergency unregister:', registration.scope);
          }
        }).catch(e => console.warn('[SW] Unregister error:', e));
        
        // Also clear all caches
        if ('caches' in window) {
          caches.keys().then(cacheNames => {
            cacheNames.forEach(cacheName => caches.delete(cacheName));
          }).catch(e => console.warn('[SW] Cache clear error:', e));
        }
      }
    })();
  </script>
  
  <!-- Config and utilities -->
  <script src="/config.js"></script>
  <!-- local-test-data.js is loaded conditionally by config.js (localhost only) -->
  <!-- Track navigation start time to prevent auth.js from blocking navigation -->
  <script>
    // Track when navigation starts to prevent auth.js from blocking mid-navigation
    window.addEventListener('click', (e) => {
      const link = e.target.closest('a[href]');
      if (link && link.href && !link.href.includes('#') && !link.href.startsWith('javascript:')) {
        // Mark that navigation is starting
        sessionStorage.setItem('navigation-start-time', Date.now().toString());
        // Also set a flag to prevent auth redirects during navigation
        sessionStorage.setItem('is-navigating', 'true');
        console.log('[Nav] Navigation started to:', link.href);
      }
    }, true);
    
    // Clear navigation flag after navigation completes or times out
    window.addEventListener('pageshow', () => {
      const navStart = sessionStorage.getItem('navigation-start-time');
      if (navStart) {
        const timeSinceNav = Date.now() - parseInt(navStart);
        if (timeSinceNav > 100) { // Navigation completed
          sessionStorage.removeItem('navigation-start-time');
          sessionStorage.removeItem('is-navigating');
          console.log('[Nav] Navigation completed');
        }
      }
    });
  </script>
  <script src="/utils/validation.js"></script>
  <script src="/utils/errorHandler.js"></script>
  <script src="/utils/performance.js"></script>
  <script src="/utils/lazyLoader.js"></script>
  <script src="/utils/mobileOptimizer.js"></script>
  <script src="/utils/accessibility.js"></script>
  <script src="/utils/analytics.js"></script>
  <script src="/utils/financialInsights.js"></script>
  <script src="/utils/themeManager.js"></script>
  <!-- Core Services - Load early for error handling -->
  <script src="/utils/authHelper.js"></script>
  <script src="/utils/dataService.js"></script>
  <!-- auth and db are now imported directly in index-inline.js, no need for separate script -->
  <script src="/app-updater.js"></script>
  
  <!-- Service Worker Registration - CONSERVATIVE -->
  <script>
    // Register service worker conservatively - only if not already registered
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        // Small delay to ensure page is fully loaded and avoid conflicts
        setTimeout(() => {
          // CRITICAL: Aggressively unregister ALL old service workers FIRST
          navigator.serviceWorker.getRegistrations().then(registrations => {
            console.log('[SW] Found', registrations.length, 'service worker(s) - unregistering...');
            const unregisterPromises = registrations.map(registration => {
              return registration.unregister().then(success => {
                console.log('[SW] Unregistered service worker:', success);
                return success;
              });
            });
            
            return Promise.all(unregisterPromises);
          }).then(() => {
            // Clear ALL caches before registering new service worker
            return caches.keys().then(cacheNames => {
              console.log('[SW] Clearing', cacheNames.length, 'cache(s)...');
              return Promise.all(cacheNames.map(cacheName => {
                return caches.delete(cacheName).then(success => {
                  console.log('[SW] Deleted cache:', cacheName, success);
                });
              }));
            });
          }).then(() => {
            // Wait a moment, then register new service worker
            setTimeout(() => {
              const swPath = '/service-worker.js';
              navigator.serviceWorker.register(swPath, { scope: '/' })
                .then(registration => {
                  console.log('[SW] ‚úÖ Service Worker v8 registered successfully!');
                  console.log('[SW] Scope:', registration.scope);
                  console.log('[SW] ‚ö†Ô∏è Old service worker may still be active - check DevTools!');
                })
                .catch(error => {
                  console.error('[SW] ‚ùå Service Worker registration failed:', error);
                });
            }, 1000); // Longer delay to ensure unregistration completes
          }).catch(error => {
            console.warn('[SW] Error during unregister/clear:', error);
            // Still try to register new one even if cleanup failed
            setTimeout(() => {
              const swPath = '/service-worker.js';
              navigator.serviceWorker.register(swPath, { scope: '/' })
                .catch(err => console.error('[SW] Registration also failed:', err));
            }, 1000);
          });
        }, 2000); // 2 second delay to ensure page is ready
      });
    } else {
      console.warn('[SW] Service Workers not supported in this browser');
    }
  </script>
  
  <!-- PWA Scrolling Fix -->
  <!-- Inline scripts moved to src/scripts/pages/index-inline.js -->
    <!-- <script>
    // Fix PWA scrolling issues
    if (window.matchMedia('(display-mode: standalone)').matches) {
      document.addEventListener('DOMContentLoaded', function() {
        // Force enable scrolling in PWA mode
        document.body.style.overflow = 'auto';
        document.body.style.webkitOverflowScrolling = 'touch';
        document.documentElement.style.overflow = 'auto';
        document.documentElement.style.webkitOverflowScrolling = 'touch';
        
        // Prevent overscroll bounce
        document.body.style.overscrollBehavior = 'none';
        document.documentElement.style.overscrollBehavior = 'none';
        
        // Ensure proper height
        document.body.style.minHeight = '100vh';
        document.documentElement.style.height = '100%';
      });
    }
  </script>
    -->
</head>
<body>
  <div class="dashboard">
    <header>
      <div class="header-title">
        <span style="font-size:2.2rem;">üíº</span>
        Bradley's Financial Tools
      </div>
      <div class="header-controls">
        <button class="control-btn" onclick="openProfileModal()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">üë§ Profile</button>
        <button class="user-menu auth-required" style="display: none; cursor:pointer;" title="Click to open profile" id="profileButton">
          <span class="user-email"></span>
          <img src="/icons/icon-192.png" alt="Profile" class="profile-avatar" style="width:36px;height:36px;border-radius:50%;object-fit:cover;margin-left:0.5rem;vertical-align:middle;box-shadow:0 1px 4px rgba(0,0,0,0.08);">
          <span class="profile-text">Profile</span>
        </button>
      </div>
    </header>


    <div class="dashboard-stats">
      <div id="creditUtilizationTile" class="stat-tile" data-type="warning">
        <div class="stat-icon">üí≥</div>
        <div class="stat-content">
          <h3>Credit Utilization</h3>
          <p class="stat-value" id="creditUtilizationValue"><span class="spinner"></span></p>
        </div>
      </div>
      <div id="netWorthTile" class="stat-tile" data-type="success">
        <div class="stat-icon">üíé</div>
        <div class="stat-content">
          <h3>Net Worth</h3>
          <p class="stat-value" id="netWorthValue"><span class="spinner"></span></p>
        </div>
      </div>
      <div id="debtSummaryTile" class="stat-tile" data-type="danger">
        <div class="stat-icon">üìä</div>
        <div class="stat-content">
          <h3>Total Debt</h3>
          <p class="stat-value" id="debtSummaryValue"><span class="spinner"></span></p>
        </div>
      </div>
      <div id="savingsTile" class="stat-tile" data-type="success">
        <div class="stat-icon">üéØ</div>
        <div class="stat-content">
          <h3>Savings Progress</h3>
          <p class="stat-value" id="savingsValue"><span class="spinner"></span></p>
        </div>
      </div>
    </div>

    <div class="tools-grid">
      <a href="/src/pages/debt/Debt_Tracker.html" class="tool-card">
        <div class="tool-icon">üìã</div>
        <h3>Debt Tracker</h3>
        <p>Track and manage your debts</p>
      </a>
      <a href="/src/pages/other/budget.html" class="tool-card">
        <div class="tool-icon">üí∞</div>
        <h3>Budget Tracker</h3>
        <p>Manage your income and expenses</p>
      </a>
      <a href="/src/pages/calculators/Velocity_Calculator.html" class="tool-card">
        <div class="tool-icon">‚ö°</div>
        <h3>Velocity Calculator</h3>
        <p>Optimize your debt payoff strategy</p>
      </a>
      <a href="/src/pages/other/net_worth_tracker.html" class="tool-card">
        <div class="tool-icon">üíé</div>
        <h3>Net Worth Tracker</h3>
        <p>Monitor your financial growth</p>
      </a>
      <a href="/src/pages/calculators/Credit_Score_Estimator.html" class="tool-card">
        <div class="tool-icon">üí≥</div>
        <h3>Credit Score Estimator</h3>
        <p>Estimate your credit score</p>
      </a>
      <a href="/src/pages/calculators/1099_calculator.html" class="tool-card">
        <div class="tool-icon">üìü</div>
        <h3>1099 Tax Estimator</h3>
        <p>Calculate your self-employed taxes</p>
      </a>
      <a href="/src/pages/savings/savings_goal_tracker.html" class="tool-card">
        <div class="tool-icon">üéØ</div>
        <h3>Savings Goal Tracker</h3>
        <p>Track your savings progress</p>
      </a>
      <a href="/src/pages/other/notifications.html" class="tool-card">
        <div class="tool-icon">üîî</div>
        <h3>Notifications</h3>
        <p>Stay updated on your finances</p>
      </a>
      <a href="/src/pages/other/activity_feed.html" class="tool-card">
        <div class="tool-icon">üßæ</div>
        <h3>Activity Feed</h3>
        <p>View your financial history</p>
      </a>
      <a href="/src/pages/savings/challenge_library.html" class="tool-card">
        <div class="tool-icon">üèÜ</div>
        <h3>Challenge Library</h3>
        <p>Explore savings challenges</p>
      </a>
    </div>

    <div class="recent-activity auth-required" style="display: none;">
      <h2>Recent Activity</h2>
      <div id="activityList"></div>
    </div>

    <!-- Financial Education Tips Section -->
    <div class="financial-education">
      <h2>üí° Financial Education Tips</h2>
      <div id="educationContainer">
        <div class="tip-card active" id="tipCard">
          <div class="tip-header">
            <span class="tip-category" id="tipCategory">Budgeting</span>
            <span class="tip-number" id="tipNumber">1 of 12</span>
          </div>
          <h3 class="tip-title" id="tipTitle">The 50/30/20 Rule</h3>
          <p class="tip-content" id="tipContent">Allocate 50% of your income to needs, 30% to wants, and 20% to savings and debt repayment. This simple framework helps maintain financial balance.</p>
          <div class="tip-actions">
            <button class="tip-btn" onclick="previousTip()">‚Üê Previous</button>
            <button class="tip-btn primary" onclick="nextTip()">Next ‚Üí</button>
          </div>
        </div>
        <div class="tip-navigation">
          <button class="nav-dot active" onclick="goToTip(0)"></button>
          <button class="nav-dot" onclick="goToTip(1)"></button>
          <button class="nav-dot" onclick="goToTip(2)"></button>
          <button class="nav-dot" onclick="goToTip(3)"></button>
          <button class="nav-dot" onclick="goToTip(4)"></button>
          <button class="nav-dot" onclick="goToTip(5)"></button>
          <button class="nav-dot" onclick="goToTip(6)"></button>
          <button class="nav-dot" onclick="goToTip(7)"></button>
          <button class="nav-dot" onclick="goToTip(8)"></button>
          <button class="nav-dot" onclick="goToTip(9)"></button>
          <button class="nav-dot" onclick="goToTip(10)"></button>
          <button class="nav-dot" onclick="goToTip(11)"></button>
        </div>
      </div>
    </div>

    <!-- Recommendations Section -->
    <div class="recommendations-section">
      <div class="recommendations">
        <h2>‚ú® Personalized Recommendations</h2>
        <div id="recommendationsContainer" class="recommendation-grid">
        <div class="recommendation-card">
          <div class="recommendation-icon">üí≥</div>
          <div class="recommendation-content">
            <h3>Start with Debt Tracking</h3>
            <p>Use our Debt Tracker to list all your debts with interest rates. This gives you a clear picture of what you owe and helps prioritize payments.</p>
            <a href="src/pages/debt/Debt_Tracker.html" class="recommendation-link">Track Your Debts ‚Üí</a>
          </div>
        </div>
        
        <div class="recommendation-card">
          <div class="recommendation-icon">üí∞</div>
          <div class="recommendation-content">
            <h3>Create Your First Budget</h3>
            <p>Set up a monthly budget to track income and expenses. This helps you understand where your money goes and identify savings opportunities.</p>
            <a href="src/pages/other/budget.html" class="recommendation-link">Build Your Budget ‚Üí</a>
          </div>
        </div>
        
        <div class="recommendation-card">
          <div class="recommendation-icon">üéØ</div>
          <div class="recommendation-content">
            <h3>Set a Savings Goal</h3>
            <p>Start with an emergency fund goal of $1,000, then work toward 3-6 months of expenses. Use our Savings Goal Tracker to stay motivated.</p>
            <a href="src/pages/savings/savings_goal_tracker.html" class="recommendation-link">Set Your Goal ‚Üí</a>
          </div>
        </div>
        
        <div class="recommendation-card">
          <div class="recommendation-icon">‚ö°</div>
          <div class="recommendation-content">
            <h3>Try Velocity Banking</h3>
            <p>If you have a line of credit, use our Velocity Calculator to see how you can pay off debts faster and save on interest.</p>
            <a href="src/pages/calculators/Velocity_Calculator.html" class="recommendation-link">Calculate Strategy ‚Üí</a>
          </div>
        </div>
        </div>
      </div>
    </div>
  </div>

  <div id="sessionTimeout" class="session-timeout" style="display: none;">
    <div class="timeout-content">
      <p>Your session will expire in <span id="timeoutCountdown">5:00</span></p>
      <button id="extendSessionBtn" class="control-btn">Extend Session</button>
    </div>
  </div>

  <!-- Profile Modal -->
  <!-- Profile Modal -->
  <div id="profileModal" class="profile-modal" style="display:none;">
    <div class="profile-modal-content">
      <!-- Close Button -->
      <button class="close-profile-modal" id="closeProfileModal" aria-label="Close profile">&times;</button>
      
      <!-- Profile Header Section -->
      <div class="profile-header-section">
        <div class="avatar-container">
          <img src="/icons/icon-192.png" alt="Profile" class="profile-avatar-large" id="profileAvatar">
          <button class="avatar-upload-btn" onclick="document.getElementById('avatarInput').click()" aria-label="Upload avatar">
            <span class="upload-icon">üì∑</span>
          </button>
          <input type="file" id="avatarInput" accept="image/*" style="display: none;" onchange="handleAvatarUpload(event)">
        </div>
        <div class="profile-info">
          <h2 id="profileName" class="profile-name">User</h2>
          <p id="profileEmail" class="profile-email">Email</p>
        </div>
      </div>
      
      <!-- Financial Metrics Section -->
      <div class="profile-metrics-section">
        <h3 class="section-title">Financial Overview</h3>
        <div class="profile-metrics-grid">
          <div class="profile-metric-card">
            <div class="metric-icon">üí∞</div>
            <div class="metric-content">
              <span class="metric-label">Net Worth</span>
              <span class="metric-value" id="profileNetWorth">-</span>
            </div>
          </div>
          <div class="profile-metric-card">
            <div class="metric-icon">üí≥</div>
            <div class="metric-content">
              <span class="metric-label">Credit Utilization</span>
              <span class="metric-value" id="profileCreditUtilization">-</span>
            </div>
          </div>
          <div class="profile-metric-card">
            <div class="metric-icon">üìâ</div>
            <div class="metric-content">
              <span class="metric-label">Total Debt</span>
              <span class="metric-value" id="profileTotalDebt">-</span>
            </div>
          </div>
          <div class="profile-metric-card">
            <div class="metric-icon">üéØ</div>
            <div class="metric-content">
              <span class="metric-label">Savings Progress</span>
              <span class="metric-value" id="profileSavings">-</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Settings Section -->
      <div class="profile-settings-section">
        <h3 class="section-title">Preferences</h3>
        <div class="settings-list">
          <div class="setting-item">
            <div class="setting-label">
              <span class="setting-icon">üåô</span>
              <span class="setting-text">Dark Mode</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="settingsDarkMode" onchange="toggleDarkModeSetting()">
              <span class="toggle-slider"></span>
            </label>
          </div>
          
          <div class="setting-item">
            <div class="setting-label">
              <span class="setting-icon">üîî</span>
              <span class="setting-text">Notifications</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="settingsNotifications" checked onchange="toggleNotifications()">
              <span class="toggle-slider"></span>
            </label>
          </div>
          
          <div class="setting-item">
            <div class="setting-label">
              <span class="setting-icon">üìä</span>
              <span class="setting-text">Auto-save Data</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="settingsAutoSave" checked onchange="toggleAutoSave()">
              <span class="toggle-slider"></span>
            </label>
          </div>
          
          <div class="setting-item">
            <div class="setting-label">
              <span class="setting-icon">üéØ</span>
              <span class="setting-text">Show Tips</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="settingsShowTips" checked onchange="toggleShowTips()">
              <span class="toggle-slider"></span>
            </label>
          </div>
          
          <div class="setting-item theme-setting-item">
            <div class="setting-label">
              <span class="setting-icon">üé®</span>
              <span class="setting-text">Color Theme</span>
            </div>
            <div class="theme-dropdown-wrapper">
              <button type="button" class="theme-dropdown-button" id="themeDropdownButton">
                <span class="theme-dropdown-selected">
                  <span class="theme-dropdown-swatch" id="themeDropdownSwatch"></span>
                  <span class="theme-dropdown-text" id="themeDropdownText">Blue</span>
                </span>
                <span class="theme-dropdown-arrow">‚ñº</span>
              </button>
              <div class="theme-dropdown-menu" id="themeDropdownMenu">
                <!-- Theme options will be populated by JavaScript -->
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Action Buttons Section -->
      <div class="profile-actions-section">
        <button class="action-btn advanced-btn" onclick="openAdvancedSettings()" id="advancedSettingsBtn">
          <span class="btn-icon">‚öôÔ∏è</span>
          <span class="btn-text">Advanced Settings</span>
        </button>
        <button class="action-btn logout-btn" onclick="logout()">
          <span class="btn-icon">üö™</span>
          <span class="btn-text">Logout</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Advanced Settings Modal -->
  <div id="advancedSettingsModal" class="advanced-settings-modal" style="display:none;">
    <div class="advanced-settings-content">
      <button class="close-advanced-settings" id="closeAdvancedSettings" aria-label="Close advanced settings">&times;</button>
      
      <div class="advanced-settings-header">
        <h2>‚öôÔ∏è Advanced Settings</h2>
        <p>Manage your data, privacy, and app preferences</p>
      </div>

      <div class="advanced-settings-sections">
        <!-- Data Management Section -->
        <div class="advanced-section">
          <h3 class="section-title">üìä Data Management</h3>
          <div class="advanced-actions">
            <button class="advanced-action-btn export-btn" onclick="exportAllData()">
              <span class="action-icon">üì•</span>
              <div class="action-content">
                <span class="action-title">Export All Data</span>
                <span class="action-desc">Download your financial data as JSON</span>
              </div>
            </button>
            <button class="advanced-action-btn export-btn" onclick="exportDataAsCSV()">
              <span class="action-icon">üìÑ</span>
              <div class="action-content">
                <span class="action-title">Export as CSV</span>
                <span class="action-desc">Download transactions and debts as CSV</span>
              </div>
            </button>
            <label class="advanced-action-btn import-btn">
              <input type="file" id="importDataInput" accept=".json,.csv" style="display:none;" onchange="importData(event)">
              <span class="action-icon">üì§</span>
              <div class="action-content">
                <span class="action-title">Import Data</span>
                <span class="action-desc">Upload JSON or CSV file to restore data</span>
              </div>
            </label>
          </div>
        </div>

        <!-- Cache & Storage Section -->
        <div class="advanced-section">
          <h3 class="section-title">üóÑÔ∏è Cache & Storage</h3>
          <div class="advanced-actions">
            <button class="advanced-action-btn cache-btn" onclick="clearLocalStorage()">
              <span class="action-icon">üóëÔ∏è</span>
              <div class="action-content">
                <span class="action-title">Clear Local Storage</span>
                <span class="action-desc">Remove locally cached data</span>
              </div>
            </button>
            <button class="advanced-action-btn cache-btn" onclick="clearCache()">
              <span class="action-icon">üßπ</span>
              <div class="action-content">
                <span class="action-title">Clear App Cache</span>
                <span class="action-desc">Clear service worker cache</span>
              </div>
            </button>
            <button class="advanced-action-btn cache-btn" onclick="unregisterServiceWorker()">
              <span class="action-icon">üîÑ</span>
              <div class="action-content">
                <span class="action-title">Reset Service Worker</span>
                <span class="action-desc">Unregister and re-register service worker</span>
              </div>
            </button>
          </div>
        </div>

        <!-- Account Information Section -->
        <div class="advanced-section">
          <h3 class="section-title">üë§ Account Information</h3>
          <div class="account-info">
            <div class="info-item">
              <span class="info-label">User ID:</span>
              <span class="info-value" id="advancedUserId">-</span>
            </div>
            <div class="info-item">
              <span class="info-label">Email:</span>
              <span class="info-value" id="advancedUserEmail">-</span>
            </div>
            <div class="info-item">
              <span class="info-label">Member Since:</span>
              <span class="info-value" id="advancedMemberSince">-</span>
            </div>
            <div class="info-item">
              <span class="info-label">Last Login:</span>
              <span class="info-value" id="advancedLastLogin">-</span>
            </div>
          </div>
        </div>

        <!-- App Statistics Section -->
        <div class="advanced-section">
          <h3 class="section-title">üìà App Statistics</h3>
          <div class="stats-grid">
            <div class="stat-item">
              <span class="stat-label">Data Entries</span>
              <span class="stat-value" id="statsDataEntries">-</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Storage Used</span>
              <span class="stat-value" id="statsStorageUsed">-</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Cache Size</span>
              <span class="stat-value" id="statsCacheSize">-</span>
            </div>
          </div>
        </div>

        <!-- Privacy Section -->
        <div class="advanced-section">
          <h3 class="section-title">üîí Privacy & Security</h3>
          <div class="privacy-actions">
            <button class="advanced-action-btn privacy-btn" onclick="requestDataDeletion()">
              <span class="action-icon">üóëÔ∏è</span>
              <div class="action-content">
                <span class="action-title">Request Data Deletion</span>
                <span class="action-desc">Permanently delete all your account data</span>
              </div>
            </button>
            <button class="advanced-action-btn privacy-btn" onclick="downloadPrivacyReport()">
              <span class="action-icon">üìã</span>
              <div class="action-content">
                <span class="action-title">Download Privacy Report</span>
                <span class="action-desc">View what data is stored about you</span>
              </div>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <style>
    /* Theme CSS Variables */
    :root {
      --primary-color: #007bff;
      --primary-hover: #0056b3;
      --border-color: #e2e8f0;
    }
    
    /* Theme-specific CSS variables */
    [data-theme="blue"] {
      --primary-color: #007bff;
      --primary-hover: #0056b3;
      --text-color: #1e293b;
      --heading-color: #0f172a;
    }
    
    [data-theme="pink"] {
      --primary-color: #ff4b91;
      --primary-hover: #e6397a;
      --text-color: #831843;
      --heading-color: #500724;
    }
    
    [data-theme="green"] {
      --primary-color: #28a745;
      --primary-hover: #218838;
      --text-color: #14532d;
      --heading-color: #052e16;
    }
    
    [data-theme="purple"] {
      --primary-color: #6f42c1;
      --primary-hover: #5a32a3;
      --text-color: #581c87;
      --heading-color: #3b0764;
    }
    
    [data-theme="orange"] {
      --primary-color: #fd7e14;
      --primary-hover: #e66a00;
      --text-color: #7c2d12;
      --heading-color: #431407;
    }
    
    [data-theme="teal"] {
      --primary-color: #20c997;
      --primary-hover: #17a085;
      --text-color: #134e4a;
      --heading-color: #042f2e;
    }
    
    [data-theme="red"] {
      --primary-color: #dc3545;
      --primary-hover: #c82333;
      --text-color: #7f1d1d;
      --heading-color: #450a0a;
    }
    
    [data-theme="blue-dark"] {
      --primary-color: #007bff;
      --primary-hover: #0056b3;
      --border-color: #404040;
      --text-color: #f1f5f9;
      --heading-color: #ffffff;
    }
    
    /* Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f8fafc;
      color: var(--text-color, #1e293b);
      line-height: 1.6;
      min-height: 100vh;
    }
    
    /* Apply theme text colors to all text elements globally */
    h1, h2, h3, h4, h5, h6 {
      color: var(--heading-color, var(--text-color, #1e293b));
    }
    
    p, span, div, li, td, th, label, .text {
      color: var(--text-color, #1e293b);
    }

    .dashboard {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem 1rem;
    }

    /* Dashboard Stats Grid */
    .dashboard-stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-tile {
      background: white;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      display: flex;
      align-items: center;
      gap: 1rem;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      border-left: 4px solid var(--primary-color, #007bff);
    }

    .stat-tile:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.12);
    }

    .stat-tile[data-type="success"] { border-left-color: #28a745; }
    .stat-tile[data-type="warning"] { border-left-color: #ffc107; }
    .stat-tile[data-type="danger"] { border-left-color: #dc3545; }

    .stat-icon {
      font-size: 2.5rem;
      flex-shrink: 0;
    }

    .stat-content {
      flex: 1;
      min-width: 0;
    }

    .stat-content h3 {
      font-size: 0.875rem;
      color: var(--text-color, #64748b);
      opacity: 0.8;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-weight: 600;
    }

    .stat-value {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--text-color, #1e293b);
      word-break: break-word;
    }

    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid #e2e8f0;
      border-top-color: var(--primary-color, #007bff);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Tools Grid */
    .tools-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .tool-card {
      background: white;
      border-radius: 1rem;
      padding: 1.75rem 1.5rem;
      text-decoration: none;
      color: inherit;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      transition: all 0.3s ease;
      border: 2px solid transparent;
      min-height: 160px;
      justify-content: center;
    }

    .tool-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      border-color: var(--primary-color, #007bff);
    }

    .tool-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .tool-card h3 {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-color, #1e293b);
      margin-bottom: 0.5rem;
    }

    .tool-card p {
      font-size: 0.875rem;
      color: var(--text-color, #64748b);
      opacity: 0.8;
      line-height: 1.5;
    }

    /* Recent Activity Section */
    .recent-activity {
      margin-top: 2rem;
      padding: 1.5rem;
      background: white;
      border-radius: 1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .recent-activity h2 {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--heading-color, var(--text-color, #1e293b));
      margin-bottom: 1.5rem;
    }

    #activityList {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .activity-item {
      padding: 1rem;
      background: #f8fafc;
      border-radius: 0.5rem;
      border-left: 3px solid var(--primary-color, #007bff);
    }

    .activity-item .date {
      font-size: 0.75rem;
      color: var(--text-color, #64748b);
      opacity: 0.8;
      margin-bottom: 0.25rem;
    }

    .activity-item .description {
      font-size: 0.875rem;
      color: var(--text-color, #1e293b);
    }

    /* Financial Insights Section */
    .financial-insights {
      margin-top: 2rem;
      padding: 1.5rem;
      background: white;
      border-radius: 1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .financial-insights h2 {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--heading-color, var(--text-color, #1e293b));
      margin-bottom: 1.5rem;
    }

    #insightsList {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .insight-card {
      padding: 1.25rem;
      background: #f8fafc;
      border-radius: 0.75rem;
      border-left: 4px solid var(--primary-color, #007bff);
    }

    .insight-card h3 {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--text-color, #1e293b);
      margin-bottom: 0.5rem;
    }

    .insight-card p {
      font-size: 0.875rem;
      color: var(--text-color, #64748b);
      opacity: 0.8;
      line-height: 1.6;
    }

    /* Recommendations Grid */
    .recommendation-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
    }

    .recommendations-section {
      margin-top: 2rem;
    }

    /* Profile Modal Styles */
    /* Profile Modal Container */
    .profile-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(5px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.3s ease;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 1rem;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from {
        transform: translateY(20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .profile-modal-content {
      background: #fff;
      border-radius: 1.5rem;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
      padding: 2rem;
      min-width: 320px;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 2rem;
      animation: slideUp 0.3s ease;
      overflow-y: auto;
      overflow-x: hidden;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
    }
    
    /* Custom scrollbar for profile modal */
    .profile-modal-content::-webkit-scrollbar {
      width: 8px;
    }
    
    .profile-modal-content::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 4px;
    }
    
    .profile-modal-content::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 4px;
    }
    
    .profile-modal-content::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }

    body.dark .profile-modal-content {
      background: #1e293b;
      color: #f1f5f9;
    }

    /* Close Button */
    .close-profile-modal {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: rgba(239, 68, 68, 0.1);
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      font-size: 1.5rem;
      color: #64748b;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }

    .close-profile-modal:hover {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
      transform: scale(1.1);
    }

    /* Profile Header Section */
    .profile-header-section {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      padding-bottom: 1.5rem;
      border-bottom: 2px solid #e2e8f0;
    }

    .avatar-container {
      position: relative;
      flex-shrink: 0;
    }

    .profile-avatar-large {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15);
      border: 3px solid #fff;
    }

    .avatar-upload-btn {
      position: absolute;
      bottom: 0;
      right: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: 3px solid #fff;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      transition: all 0.3s ease;
      z-index: 10;
    }

    .avatar-upload-btn:hover {
      transform: scale(1.15);
      box-shadow: 0 6px 16px rgba(102, 126, 234, 0.5);
    }

    .upload-icon {
      font-size: 16px;
    }

    .profile-info {
      flex: 1;
      min-width: 0;
    }

    .profile-name {
      margin: 0 0 0.5rem 0;
      font-size: 1.5rem;
      font-weight: 700;
      color: #0f172a;
      line-height: 1.2;
    }

    .profile-email {
      margin: 0;
      color: #64748b;
      font-size: 0.95rem;
      word-break: break-word;
    }

    body.dark .profile-name {
      color: #f1f5f9;
    }

    body.dark .profile-email {
      color: #94a3b8;
    }

    body.dark .profile-header-section {
      border-bottom-color: #334155;
    }

    /* Financial Metrics Section */
    .profile-metrics-section {
      width: 100%;
    }

    .section-title {
      margin: 0 0 1rem 0;
      font-size: 1.1rem;
      font-weight: 700;
      color: #1e293b;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    body.dark .section-title {
      color: #f1f5f9;
    }

    .profile-metrics-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }

    .profile-metric-card {
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border: 1px solid #e2e8f0;
      border-radius: 0.875rem;
      padding: 1rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      transition: all 0.3s ease;
    }

    .profile-metric-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      border-color: #cbd5e1;
    }

    .metric-icon {
      font-size: 1.75rem;
      flex-shrink: 0;
    }

    .metric-content {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      flex: 1;
      min-width: 0;
    }

    .metric-label {
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: #64748b;
      line-height: 1.2;
    }

    .metric-value {
      font-size: 1.1rem;
      font-weight: 700;
      color: #0f172a;
      line-height: 1.2;
      word-break: break-word;
    }

    body.dark .profile-metric-card {
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      border-color: #334155;
    }

    body.dark .profile-metric-card:hover {
      border-color: #475569;
    }

    body.dark .metric-label {
      color: #94a3b8;
    }

    body.dark .metric-value {
      color: #f1f5f9;
    }

    .avatar-container {
      position: relative;
      display: inline-block;
    }

    .avatar-upload-btn {
      position: absolute;
      bottom: -5px;
      right: -5px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: 3px solid white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      transition: all 0.3s ease;
      z-index: 10;
    }

    .avatar-upload-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .upload-icon {
      font-size: 18px;
    }


    /* Settings Section */
    .profile-settings-section {
      width: 100%;
      padding-top: 1rem;
      border-top: 2px solid #e2e8f0;
    }

    body.dark .profile-settings-section {
      border-top-color: #334155;
    }

    .settings-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-top: 1rem;
    }

    .setting-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.875rem 1rem;
      background: #f8fafc;
      border-radius: 0.75rem;
      border: 1px solid #e2e8f0;
      transition: all 0.2s ease;
      position: relative;
    }

    .setting-item:hover {
      background: #f1f5f9;
      border-color: #cbd5e1;
    }

    body.dark .setting-item {
      background: #1e293b;
      border-color: #334155;
    }

    body.dark .setting-item:hover {
      background: #0f172a;
      border-color: #475569;
    }
    
    /* Theme Dropdown Styles */
    .theme-dropdown-wrapper {
      position: relative;
      width: 100%;
      max-width: 250px;
      z-index: 10;
    }
    
    /* Color theme setting item needs extra spacing */
    .setting-item.theme-setting-item {
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      min-height: 60px;
    }
    
    .theme-dropdown-button {
      width: 100%;
      padding: 0.75rem 1rem;
      padding-right: 2.5rem;
      border: 2px solid var(--border-color);
      border-radius: 0.625rem;
      background: #ffffff;
      color: #1e293b;
      font-size: 0.9375rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      justify-content: space-between;
      align-items: center;
      text-align: left;
      position: relative;
      box-sizing: border-box;
    }
    
    .theme-dropdown-button:hover {
      border-color: var(--primary-color);
      background: #f8fafc;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .theme-dropdown-button.active {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(0,123,255,0.1);
    }
    
    .theme-dropdown-selected {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex: 1;
      min-width: 0;
    }
    
    .theme-dropdown-swatch {
      width: 28px;
      height: 28px;
      border-radius: 6px;
      border: 2px solid rgba(0,0,0,0.1);
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      flex-shrink: 0;
      display: block;
    }
    
    .theme-dropdown-text {
      flex: 1;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .theme-dropdown-arrow {
      position: absolute;
      right: 1rem;
      font-size: 0.75rem;
      color: #64748b;
      pointer-events: none;
      transition: transform 0.2s ease;
    }
    
    .theme-dropdown-button.active .theme-dropdown-arrow {
      transform: rotate(180deg);
    }
    
    .theme-dropdown-menu {
      position: absolute;
      bottom: calc(100% + 0.75rem);
      left: 0;
      right: 0;
      background: #ffffff;
      border: 2px solid var(--border-color);
      border-radius: 0.625rem;
      box-shadow: 0 4px 16px rgba(0,0,0,0.12);
      z-index: 1001;
      max-height: 280px;
      overflow-y: auto;
      overflow-x: hidden;
      display: none;
      margin-bottom: 0.5rem;
    }
    
    .theme-dropdown-menu.show {
      display: block;
    }
    
    /* Custom scrollbar for dropdown */
    .theme-dropdown-menu::-webkit-scrollbar {
      width: 6px;
    }
    
    .theme-dropdown-menu::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 3px;
    }
    
    .theme-dropdown-menu::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 3px;
    }
    
    .theme-dropdown-menu::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }
    
    .theme-dropdown-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      cursor: pointer;
      transition: background 0.15s ease;
      border-bottom: 1px solid #f1f5f9;
      position: relative;
    }
    
    .theme-dropdown-item:last-child {
      border-bottom: none;
    }
    
    .theme-dropdown-item:hover {
      background: #f8fafc;
    }
    
    .theme-dropdown-item.active {
      background: #e0f2fe;
      font-weight: 600;
    }
    
    .theme-dropdown-item-swatch {
      width: 28px;
      height: 28px;
      border-radius: 6px;
      border: 2px solid rgba(0,0,0,0.1);
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      flex-shrink: 0;
      display: block;
    }
    
    .theme-dropdown-item.active .theme-dropdown-item-swatch {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(0,123,255,0.15);
    }
    
    .theme-dropdown-item-icon {
      font-size: 1.1rem;
      width: 20px;
      text-align: center;
      flex-shrink: 0;
    }
    
    .theme-dropdown-item-name {
      flex: 1;
      font-size: 0.9375rem;
      color: #1e293b;
      font-weight: 500;
    }
    
    .theme-dropdown-item.active .theme-dropdown-item-name {
      color: var(--primary-color);
      font-weight: 600;
    }
    
    .theme-dropdown-item-check {
      color: var(--primary-color);
      font-weight: bold;
      font-size: 1rem;
      flex-shrink: 0;
      width: 20px;
      text-align: center;
    }
    
    /* Dark theme dropdown styling */
    [data-theme="blue-dark"] .theme-dropdown-button {
      background: #2b2b2b;
      color: #f4f4f9;
      border-color: #404040;
    }
    
    [data-theme="blue-dark"] .theme-dropdown-button:hover {
      background: #3a3a3a;
    }
    
    [data-theme="blue-dark"] .theme-dropdown-menu {
      background: #2b2b2b;
      border-color: #404040;
    }
    
    [data-theme="blue-dark"] .theme-dropdown-item {
      border-bottom-color: #404040;
      color: #f4f4f9;
    }
    
    [data-theme="blue-dark"] .theme-dropdown-item:hover {
      background: #3a3a3a;
    }
    
    [data-theme="blue-dark"] .theme-dropdown-item.active {
      background: #1e3a5f;
    }
    
    [data-theme="blue-dark"] .theme-dropdown-item-name {
      color: #f4f4f9;
    }
    
    /* Mobile responsive */
    @media (max-width: 768px) {
      .theme-dropdown-wrapper {
        max-width: 100%;
      }
      
      .theme-dropdown-button {
        padding: 0.875rem 1rem;
        padding-right: 2.5rem;
      }
      
      .theme-dropdown-menu {
        max-height: 280px;
      }
    }
    
    /* Dark theme styling */
    [data-theme="blue-dark"] .theme-option {
      background: #2b2b2b;
      border-color: #404040;
      color: #f4f4f9;
    }
    
    [data-theme="blue-dark"] .theme-option:hover {
      background: #3a3a3a;
      border-color: var(--primary-color);
    }
    
    [data-theme="blue-dark"] .theme-option.active {
      background: #1e3a5f;
      border-color: var(--primary-color);
    }
    
    [data-theme="blue-dark"] .theme-option-name {
      color: #f4f4f9;
    }

    .setting-label {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex: 1;
      cursor: default;
    }

    .setting-icon {
      font-size: 1.25rem;
      width: 24px;
      text-align: center;
      flex-shrink: 0;
    }

    .setting-text {
      font-weight: 600;
      color: #1e293b;
      font-size: 0.95rem;
    }

    body.dark .setting-text {
      color: #f1f5f9;
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 48px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #cbd5e1;
      transition: 0.3s;
      border-radius: 24px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: 0.3s;
      border-radius: 50%;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    input:checked + .toggle-slider {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    input:checked + .toggle-slider:before {
      transform: translateX(24px);
    }

    /* Action Buttons Section */
    .profile-actions-section {
      width: 100%;
      padding-top: 1rem;
      border-top: 2px solid #e2e8f0;
      display: flex;
      flex-direction: row;
      gap: 0.75rem;
    }

    body.dark .profile-actions-section {
      border-top-color: #334155;
    }

    .action-btn {
      flex: 1;
      border: none;
      padding: 0.875rem 1.25rem;
      border-radius: 0.75rem;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    }

    .action-btn:active {
      transform: translateY(0);
    }

    .advanced-btn {
      background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
      color: white;
    }

    .advanced-btn:hover {
      background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
    }

    .btn-icon {
      font-size: 1.1rem;
    }

    .btn-text {
      font-weight: 600;
      font-size: 0.95rem;
    }

    /* Responsive Design */
    @media (max-width: 640px) {
      .profile-modal {
        padding: 0.5rem;
      }

      .profile-modal-content {
        padding: 1.5rem;
        gap: 1.5rem;
        max-height: 95vh;
      }

      .profile-header-section {
        flex-direction: column;
        text-align: center;
        gap: 1rem;
      }

      .profile-metrics-grid {
        grid-template-columns: 1fr;
      }

      .profile-actions-section {
        flex-direction: column;
      }

      .section-title {
        font-size: 1rem;
      }
    }

    /* Advanced Settings Modal */
    .advanced-settings-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(5px);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.3s ease;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 1rem;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
    }

    .advanced-settings-content {
      background: #fff;
      border-radius: 1.5rem;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
      padding: 2rem;
      min-width: 320px;
      max-width: 700px;
      width: 100%;
      max-height: 90vh;
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      animation: slideUp 0.3s ease;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .advanced-settings-content::-webkit-scrollbar {
      width: 8px;
    }

    .advanced-settings-content::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 4px;
    }

    .advanced-settings-content::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 4px;
    }

    .advanced-settings-content::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }

    body.dark .advanced-settings-content {
      background: #1e293b;
      color: #f1f5f9;
    }

    .close-advanced-settings {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: rgba(239, 68, 68, 0.1);
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      font-size: 1.5rem;
      color: #64748b;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }

    .close-advanced-settings:hover {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
      transform: scale(1.1);
    }

    .advanced-settings-header {
      text-align: center;
      padding-bottom: 1rem;
      border-bottom: 2px solid #e2e8f0;
    }

    .advanced-settings-header h2 {
      margin: 0 0 0.5rem 0;
      font-size: 1.75rem;
      font-weight: 700;
      color: #0f172a;
    }

    .advanced-settings-header p {
      margin: 0;
      color: #64748b;
      font-size: 0.95rem;
    }

    body.dark .advanced-settings-header {
      border-bottom-color: #334155;
    }

    body.dark .advanced-settings-header h2 {
      color: #f1f5f9;
    }

    body.dark .advanced-settings-header p {
      color: #94a3b8;
    }

    .advanced-settings-sections {
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }

    .advanced-section {
      width: 100%;
    }

    .advanced-actions {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-top: 1rem;
    }

    .advanced-action-btn {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem 1.25rem;
      background: #f8fafc;
      border: 2px solid #e2e8f0;
      border-radius: 0.875rem;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: left;
    }

    .advanced-action-btn:hover {
      background: #f1f5f9;
      border-color: #cbd5e1;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .action-icon {
      font-size: 1.75rem;
      flex-shrink: 0;
    }

    .action-content {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      flex: 1;
    }

    .action-title {
      font-weight: 600;
      font-size: 0.95rem;
      color: #1e293b;
    }

    .action-desc {
      font-size: 0.85rem;
      color: #64748b;
      line-height: 1.4;
    }

    body.dark .advanced-action-btn {
      background: #1e293b;
      border-color: #334155;
    }

    body.dark .advanced-action-btn:hover {
      background: #0f172a;
      border-color: #475569;
    }

    body.dark .action-title {
      color: #f1f5f9;
    }

    body.dark .action-desc {
      color: #94a3b8;
    }

    /* Account Info */
    .account-info {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-top: 1rem;
      padding: 1rem;
      background: #f8fafc;
      border-radius: 0.875rem;
      border: 1px solid #e2e8f0;
    }

    .info-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
    }

    .info-label {
      font-weight: 600;
      font-size: 0.9rem;
      color: #64748b;
    }

    .info-value {
      font-weight: 600;
      font-size: 0.9rem;
      color: #1e293b;
      word-break: break-word;
      text-align: right;
      max-width: 60%;
    }

    body.dark .account-info {
      background: #1e293b;
      border-color: #334155;
    }

    body.dark .info-label {
      color: #94a3b8;
    }

    body.dark .info-value {
      color: #f1f5f9;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .stat-item {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 0.875rem;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      text-align: center;
    }

    .stat-label {
      font-size: 0.8rem;
      font-weight: 600;
      color: #64748b;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .stat-value {
      font-size: 1.25rem;
      font-weight: 700;
      color: #1e293b;
    }

    body.dark .stat-item {
      background: #1e293b;
      border-color: #334155;
    }

    body.dark .stat-label {
      color: #94a3b8;
    }

    body.dark .stat-value {
      color: #f1f5f9;
    }

    /* Privacy Actions */
    .privacy-actions {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-top: 1rem;
    }

    .privacy-btn {
      border-color: #fee2e2;
      background: #fef2f2;
    }

    .privacy-btn:hover {
      border-color: #fecaca;
      background: #fee2e2;
    }

    body.dark .privacy-btn {
      background: #2f1f1f;
      border-color: #4a2a2a;
    }

    body.dark .privacy-btn:hover {
      background: #3a2424;
      border-color: #5a3434;
    }

    @media (max-width: 640px) {
      .advanced-settings-modal {
        padding: 0.5rem;
      }

      .advanced-settings-content {
        padding: 1.5rem;
        gap: 1.25rem;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Notification animations */
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes slideOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }

    .logout-btn {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.15);
    }

    .logout-btn:hover {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
    }

    body.dark .logout-btn {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    }

    body.dark .logout-btn:hover {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
    }

    /* Comprehensive Dark Mode Styles */
    body.dark {
      background: #0f172a;
      color: #f1f5f9;
    }

    body.dark .dashboard {
      background: #0f172a;
    }

    body.dark .stat-tile {
      background: #1e293b;
      color: #f1f5f9;
      border-color: #334155;
    }

    body.dark .tool-card {
      background: #1e293b;
      color: #f1f5f9;
      border-color: #334155;
    }

    body.dark .tool-card:hover {
      background: #334155;
      transform: translateY(-2px);
    }

    body.dark .financial-education {
      background: rgba(30, 41, 59, 0.8);
      color: #f1f5f9;
    }

    body.dark .recommendations {
      background: rgba(30, 41, 59, 0.8);
      color: #f1f5f9;
    }

    body.dark .recommendation-card {
      background: #1e293b;
      color: #f1f5f9;
      border-color: #334155;
    }

    body.dark .recommendation-content h3 {
      color: #f1f5f9;
    }

    body.dark .recommendation-content p {
      color: #cbd5e1;
    }

    body.dark .tip-card {
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      color: #f1f5f9;
    }

    body.dark .tip-btn {
      background: rgba(255,255,255,0.1);
      color: #f1f5f9;
      border-color: rgba(255,255,255,0.2);
    }

    body.dark .tip-btn:hover {
      background: rgba(255,255,255,0.2);
    }

    body.dark .tip-btn.primary {
      background: rgba(255,255,255,0.9);
      color: #1e293b;
    }

    body.dark .nav-dot {
      background: rgba(255,255,255,0.3);
    }

    body.dark .nav-dot.active {
      background: #f1f5f9;
    }

    body.dark .nav-dot:hover {
      background: #f1f5f9;
    }

    /* Dark mode adjustments for new sections */
    body.dark .recent-activity,
    body.dark .financial-insights {
      background: #1e293b;
      color: #f1f5f9;
    }

    body.dark .recent-activity h2,
    body.dark .financial-insights h2 {
      color: #f1f5f9;
    }

    body.dark .activity-item,
    body.dark .insight-card {
      background: #0f172a;
      border-left-color: #667eea;
    }

    body.dark .activity-item .description,
    body.dark .insight-card h3 {
      color: #f1f5f9;
    }

    body.dark .activity-item .date,
    body.dark .insight-card p {
      color: #94a3b8;
    }

    @media (max-width: 600px) {
      .profile-modal { 
        padding: 1rem; 
        align-items: flex-start;
        padding-top: 2rem;
      }
      .profile-modal-content { 
        padding: 1.2rem 0.5rem; 
        max-height: 95vh;
        margin: 0;
      }
      .profile-header { flex-direction: column; gap: 0.7rem; }
    }

    /* Header Styles */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem 2rem;
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(0,0,0,0.1);
      box-shadow: 0 2px 20px rgba(0,0,0,0.1);
      margin-bottom: 2rem;
    }

    .header-title {
      display: flex;
      align-items: center;
      gap: 1rem;
      font-size: 2rem;
      font-weight: 800;
      color: #1e293b;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      letter-spacing: -0.02em;
    }

    .header-controls {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .control-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 0.75rem;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .control-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem 1rem;
      background: rgba(102, 126, 234, 0.1);
      border-radius: 0.75rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .user-menu:hover {
      background: rgba(102, 126, 234, 0.2);
      transform: translateY(-1px);
    }

    .user-email {
      font-weight: 600;
      color: #1e293b;
      font-size: 0.9rem;
    }

    .profile-text {
      font-weight: 600;
      color: #1e293b;
      font-size: 0.9rem;
      margin-left: 0.5rem;
    }

    /* Dark mode header adjustments */
    body.dark header {
      background: rgba(35, 41, 70, 0.95);
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    body.dark .header-title {
      color: #f4f4f9;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    body.dark .user-email {
      color: #f4f4f9;
    }

    body.dark .profile-text {
      color: #f4f4f9;
    }

    body.dark .user-menu {
      background: rgba(102, 126, 234, 0.2);
    }

    body.dark .user-menu:hover {
      background: rgba(102, 126, 234, 0.3);
    }

    /* Mobile responsiveness - Comprehensive */
    @media (max-width: 768px) {
      /* Dashboard container */
      .dashboard {
        padding: 0.75rem;
        max-width: 100%;
        margin: 0;
      }

      /* Header */
      header {
        padding: 1rem 0.75rem;
        flex-direction: column;
        gap: 0.75rem;
        text-align: center;
        margin-bottom: 1rem;
      }

      .header-title {
        font-size: 1.25rem;
        gap: 0.5rem;
      }

      .header-title span {
        font-size: 1.5rem;
      }

      .header-controls {
        width: 100%;
        flex-direction: row;
        justify-content: center;
        gap: 0.5rem;
      }

      .control-btn {
        padding: 0.625rem 1rem;
        font-size: 0.875rem;
        flex: 1;
        max-width: 200px;
      }

      /* Dashboard Stats Grid */
      .dashboard-stats {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
        margin-bottom: 1.5rem;
      }

      .stat-tile {
        padding: 1rem 0.75rem;
        min-height: auto;
      }

      .stat-icon {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
      }

      .stat-content h3 {
        font-size: 0.75rem;
        margin-bottom: 0.25rem;
      }

      .stat-value {
        font-size: 1.25rem;
      }

      /* Tools Grid */
      .tools-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
        margin-bottom: 1.5rem;
      }

      .tool-card {
        padding: 1.25rem 0.75rem;
        min-height: 120px;
      }

      .tool-icon {
        font-size: 2rem;
        margin-bottom: 0.5rem;
      }

      .tool-card h3 {
        font-size: 1rem;
        margin-bottom: 0.25rem;
      }

      .tool-card p {
        font-size: 0.75rem;
        line-height: 1.3;
      }

      /* Financial Education */
      .financial-education {
        padding: 1rem;
        margin-top: 1.5rem;
      }

      .financial-education h2 {
        font-size: 1.25rem;
        margin-bottom: 1rem;
      }

      .tip-card {
        padding: 1.5rem;
      }

      .tip-title {
        font-size: 1.25rem;
      }

      .tip-content {
        font-size: 0.875rem;
        line-height: 1.5;
      }

      .tip-actions {
        flex-direction: column;
        gap: 0.5rem;
      }

      .tip-btn {
        width: 100%;
        padding: 0.75rem;
      }

      /* Recommendations */
      .recommendations {
        padding: 1rem;
      }

      .recommendations h2 {
        font-size: 1.25rem;
        margin-bottom: 1rem;
      }

      .recommendation-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .recommendation-card {
        flex-direction: column;
        padding: 1.25rem;
      }

      .recommendation-icon {
        width: 50px;
        height: 50px;
        font-size: 1.5rem;
      }

      .recommendation-content h3 {
        font-size: 1.125rem;
      }

      .recommendation-content p {
        font-size: 0.875rem;
        line-height: 1.5;
      }

      /* Profile Modal */
      .profile-modal {
        padding: 0.5rem;
      }

      .profile-modal-content {
        padding: 1.25rem;
        min-width: 95vw;
        max-width: 95vw;
      }

      .profile-metrics {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
      }

      .profile-metric {
        padding: 0.75rem;
      }

      .metric-value {
        font-size: 1rem;
      }

      /* Settings */
      .settings-group {
        gap: 0.75rem;
      }

      .setting-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
        padding: 0.75rem 0;
      }

      .theme-dropdown-wrapper {
        width: 100%;
        max-width: 100%;
      }
    }

    /* Small Mobile (480px and below) */
    @media (max-width: 480px) {
      .dashboard {
        padding: 0.5rem;
      }

      .dashboard-stats {
        grid-template-columns: 1fr;
        gap: 0.5rem;
      }

      .tools-grid {
        grid-template-columns: 1fr;
        gap: 0.5rem;
      }

      .tool-card {
        padding: 1rem 0.75rem;
        min-height: 100px;
      }

      .header-title {
        font-size: 1.125rem;
      }

      .control-btn {
        padding: 0.625rem 0.875rem;
        font-size: 0.8125rem;
      }

    }

    /* Financial Education Styles */
    .financial-education {
      margin-top: 2rem;
      padding: 1.5rem;
      background: rgba(255,255,255,0.65);
      border-radius: 1.25rem;
      box-shadow: 0 4px 24px rgba(37,99,235,0.08);
      backdrop-filter: blur(4px);
    }

    .financial-education h2 {
      margin: 0 0 1.5rem 0;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text);
      text-align: center;
    }

    .tip-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 2rem;
      border-radius: 1rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      opacity: 0;
      transform: translateX(20px);
    }

    .tip-card.active {
      opacity: 1;
      transform: translateX(0);
    }

    .tip-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .tip-category {
      background: rgba(255,255,255,0.2);
      padding: 0.25rem 0.75rem;
      border-radius: 1rem;
      font-size: 0.875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .tip-number {
      font-size: 0.875rem;
      opacity: 0.8;
    }

    .tip-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin: 0 0 1rem 0;
      line-height: 1.3;
    }

    .tip-content {
      font-size: 1rem;
      line-height: 1.6;
      margin: 0 0 1.5rem 0;
      opacity: 0.95;
    }

    .tip-actions {
      display: flex;
      gap: 1rem;
      justify-content: center;
    }

    .tip-btn {
      background: rgba(255,255,255,0.2);
      color: white;
      border: 1px solid rgba(255,255,255,0.3);
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .tip-btn:hover {
      background: rgba(255,255,255,0.3);
      transform: translateY(-2px);
    }

    .tip-btn.primary {
      background: rgba(255,255,255,0.9);
      color: #667eea;
    }

    .tip-btn.primary:hover {
      background: white;
    }

    .tip-navigation {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 1.5rem;
    }

    .nav-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: none;
      background: rgba(102, 126, 234, 0.3);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .nav-dot.active {
      background: #667eea;
      transform: scale(1.2);
    }

    .nav-dot:hover {
      background: #667eea;
      transform: scale(1.1);
    }

    /* Recommendations Styles */
    .recommendations {
      margin-top: 2rem;
      padding: 1.5rem;
      background: rgba(255,255,255,0.65);
      border-radius: 1.25rem;
      box-shadow: 0 4px 24px rgba(37,99,235,0.08);
      backdrop-filter: blur(4px);
    }

    .recommendations h2 {
      margin: 0 0 1.5rem 0;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text);
      text-align: center;
    }

    .recommendation-card {
      background: white;
      border-radius: 1rem;
      padding: 1.5rem;
      margin-bottom: 1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      transition: all 0.3s ease;
      border-left: 4px solid #667eea;
    }

    .recommendation-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }

    .recommendation-icon {
      font-size: 2rem;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      flex-shrink: 0;
    }

    .recommendation-content {
      flex: 1;
    }

    .recommendation-content h3 {
      margin: 0 0 0.5rem 0;
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text);
    }

    .recommendation-content p {
      margin: 0 0 1rem 0;
      color: #6b7280;
      line-height: 1.6;
    }

    .recommendation-link {
      display: inline-block;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .recommendation-link:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .insight-card, .recommendation-card {
      background: white;
      border-radius: 1rem;
      padding: 1.5rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      border-left: 4px solid var(--primary);
    }

    .insight-card h3, .recommendation-card h3 {
      margin: 0 0 1rem 0;
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--text);
    }

    .insight-data {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }

    .data-point {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid #f1f5f9;
    }

    .data-label {
      font-weight: 500;
      color: var(--muted);
    }

    .data-value {
      font-weight: 600;
      color: var(--primary);
    }

    .recommendation-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .priority-badge {
      background: var(--primary);
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .recommendation-card.priority-5 .priority-badge { background: #ef4444; }
    .recommendation-card.priority-4 .priority-badge { background: #f59e0b; }
    .recommendation-card.priority-3 .priority-badge { background: #3b82f6; }
    .recommendation-card.priority-2 .priority-badge { background: #10b981; }
    .recommendation-card.priority-1 .priority-badge { background: #6b7280; }

    .recommendation-description {
      margin: 0 0 1rem 0;
      color: var(--muted);
      line-height: 1.6;
    }

    .recommendation-action {
      background: #f8fafc;
      padding: 1rem;
      border-radius: 0.5rem;
      border-left: 3px solid var(--primary);
    }

    .insights-loading, .recommendations-loading {
      text-align: center;
      padding: 2rem;
      color: var(--muted);
    }

    .insights-loading .spinner, .recommendations-loading .spinner {
      margin-bottom: 1rem;
    }

    .error-state {
      text-align: center;
      padding: 2rem;
      color: #ef4444;
      background: #fef2f2;
      border-radius: 0.5rem;
      border: 1px solid #fecaca;
    }

    .info-state {
      text-align: center;
      padding: 2rem;
      color: #2563eb;
      background: #eff6ff;
      border-radius: 0.5rem;
      border: 1px solid #bfdbfe;
    }

    /* Dark mode adjustments - using theme variables */
    [data-theme="dark"] .financial-education {
      background: rgba(35, 41, 70, 0.65);
    }

    [data-theme="dark"] .recommendations {
      background: rgba(35, 41, 70, 0.65);
    }

    [data-theme="dark"] .recommendation-card {
      background: var(--bg-card);
      color: var(--text-color);
    }

    [data-theme="dark"] .recommendation-content h3 {
      color: var(--text-color);
    }

    [data-theme="dark"] .recommendation-content p {
      color: var(--text-muted);
    }

    [data-theme="dark"] .insight-card, 
    [data-theme="dark"] .recommendation-card {
      background: var(--bg-card);
      color: var(--text-color);
    }

    [data-theme="dark"] .data-point {
      border-bottom-color: var(--border-color);
    }

    [data-theme="dark"] .recommendation-action {
      background: var(--bg-secondary);
    }
    
    /* Fun theme adjustments */
    [data-theme="fun"] .recommendation-action {
      background: var(--bg-card);
    }
  </style>
  
  <footer style="text-align: center; margin-top: 40px; padding: 20px; font-weight: bold; font-size: 14px; color: var(--text-muted); border-top: 1px solid var(--border-color);">
    This is a product of Bradley Virtual Solutions, LLC
  </footer>
  
  <script>
    // Theme Selector Initialization
    function initializeThemeSelector() {
      const button = document.getElementById('themeDropdownButton');
      const menu = document.getElementById('themeDropdownMenu');
      const swatch = document.getElementById('themeDropdownSwatch');
      const text = document.getElementById('themeDropdownText');
      
      if (!button || !menu) {
        console.warn('[Theme Selector] Button or menu not found');
        return;
      }
      
      // Wait for themeManager if not ready
      if (!window.themeManager) {
        console.warn('[Theme Selector] ThemeManager not available yet, retrying...');
        setTimeout(initializeThemeSelector, 200);
        return;
      }
      
      // Clear existing items
      menu.innerHTML = '';
      
      // Get available themes
      const themes = window.themeManager.getAvailableThemes();
      
      if (!themes || themes.length === 0) {
        console.warn('[Theme Selector] No themes available');
        return;
      }
      
      // Create menu items
      themes.forEach(theme => {
        const themeInfo = window.themeManager.getThemeInfo(theme);
        const item = document.createElement('div');
        item.className = 'theme-dropdown-item';
        if (window.themeManager.getCurrentTheme() === theme) {
          item.classList.add('active');
        }
        item.innerHTML = `
          <span class="theme-dropdown-swatch" style="background-color: ${themeInfo.color}"></span>
          <span class="theme-dropdown-text">${themeInfo.icon} ${themeInfo.name}</span>
        `;
        item.addEventListener('click', (e) => {
          e.stopPropagation();
          window.themeManager.setTheme(theme);
          updateThemeSelector();
          button.classList.remove('active');
          menu.classList.remove('show');
        });
        menu.appendChild(item);
      });
      
      // Update display
      updateThemeSelector();
      
      // Remove existing click listeners to prevent duplicates
      const newButton = button.cloneNode(true);
      button.parentNode.replaceChild(newButton, button);
      
      // Toggle menu on button click
      newButton.addEventListener('click', (e) => {
        e.stopPropagation();
        newButton.classList.toggle('active');
        menu.classList.toggle('show');
      });
      
      // Close menu when clicking outside (only add once)
      if (!window._themeSelectorClickHandler) {
        window._themeSelectorClickHandler = (e) => {
          const btn = document.getElementById('themeDropdownButton');
          const mnu = document.getElementById('themeDropdownMenu');
          if (btn && mnu && !btn.contains(e.target) && !mnu.contains(e.target)) {
            btn.classList.remove('active');
            mnu.classList.remove('show');
          }
        };
        document.addEventListener('click', window._themeSelectorClickHandler);
      }
    }
    
    function updateThemeSelector() {
      const swatch = document.getElementById('themeDropdownSwatch');
      const text = document.getElementById('themeDropdownText');
      if (!swatch || !text || !window.themeManager) return;
      
      const currentTheme = window.themeManager.getCurrentTheme();
      const themeInfo = window.themeManager.getThemeInfo(currentTheme);
      swatch.style.backgroundColor = themeInfo.color;
      text.textContent = themeInfo.icon + ' ' + themeInfo.name;
      
      // Update active state in menu
      const menu = document.getElementById('themeDropdownMenu');
      if (menu) {
        const items = menu.querySelectorAll('.theme-dropdown-item');
        items.forEach(item => item.classList.remove('active'));
        items.forEach(item => {
          if (item.textContent.includes(themeInfo.name)) {
            item.classList.add('active');
          }
        });
      }
    }
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        setTimeout(initializeThemeSelector, 500);
        // Listen for theme changes
        window.addEventListener('themechange', updateThemeSelector);
      });
    } else {
      setTimeout(initializeThemeSelector, 500);
      window.addEventListener('themechange', updateThemeSelector);
    }
    
    // Load profile data
    async function loadProfileData() {
      try {
        // Load user info
        if (window.auth && window.auth.currentUser) {
          const user = window.auth.currentUser;
          const nameEl = document.getElementById('profileName');
          const emailEl = document.getElementById('profileEmail');
          
          if (nameEl) {
            nameEl.textContent = user.displayName || user.email?.split('@')[0] || 'User';
          }
          if (emailEl) {
            emailEl.textContent = user.email || 'Email';
          }
        } else {
          // Set default values if not authenticated
          const nameEl = document.getElementById('profileName');
          const emailEl = document.getElementById('profileEmail');
          if (nameEl) nameEl.textContent = 'User';
          if (emailEl) emailEl.textContent = 'Email';
        }
        
        // Load profile metrics if DataService is available
        if (window.DataService && window.auth && window.auth.currentUser) {
          // Load net worth
          try {
            const netWorth = await window.DataService.getNetWorth();
            const netWorthEl = document.getElementById('profileNetWorth');
            if (netWorthEl && netWorth) {
              const netWorthValue = (netWorth.assets || 0) - (netWorth.liabilities || 0);
              netWorthEl.textContent = window.DataService.formatCurrency(netWorthValue);
            }
          } catch (e) {
            const netWorthEl = document.getElementById('profileNetWorth');
            if (netWorthEl) netWorthEl.textContent = '-';
          }
          
          // Load total debt
          try {
            const debts = await window.DataService.getDebts();
            const totalDebt = debts.reduce((sum, debt) => sum + (debt.balance || 0), 0);
            const totalDebtEl = document.getElementById('profileTotalDebt');
            if (totalDebtEl) {
              totalDebtEl.textContent = window.DataService.formatCurrency(totalDebt);
            }
          } catch (e) {
            const totalDebtEl = document.getElementById('profileTotalDebt');
            if (totalDebtEl) totalDebtEl.textContent = '-';
          }
          
          // Load savings
          try {
            const savingsGoals = await window.DataService.getSavingsGoals();
            const savingsEl = document.getElementById('profileSavings');
            if (savingsEl && savingsGoals && savingsGoals.length > 0) {
              const totalCurrent = savingsGoals.reduce((sum, goal) => sum + (goal.currentAmount || 0), 0);
              const totalTarget = savingsGoals.reduce((sum, goal) => sum + (goal.targetAmount || 0), 0);
              savingsEl.textContent = window.DataService.formatCurrency(totalCurrent) + ' / ' + window.DataService.formatCurrency(totalTarget);
            } else if (savingsEl) {
              savingsEl.textContent = '-';
            }
          } catch (e) {
            const savingsEl = document.getElementById('profileSavings');
            if (savingsEl) savingsEl.textContent = '-';
          }
          
          // Credit utilization (placeholder)
          const creditUtilEl = document.getElementById('profileCreditUtilization');
          if (creditUtilEl) creditUtilEl.textContent = 'N/A';
        }
      } catch (error) {
        console.error('[Profile] Error loading profile data:', error);
      }
    }
    
    // Re-initialize when profile modal opens
    function openProfileModal() {
      const modal = document.getElementById('profileModal');
      if (modal) {
        modal.style.display = 'flex';
        // Load profile data and initialize theme selector
        loadProfileData();
        setTimeout(() => {
          initializeThemeSelector();
        }, 200);
      }
    }
    
    function closeProfileModal() {
      const modal = document.getElementById('profileModal');
      if (modal) {
        modal.style.display = 'none';
      }
    }
    
    // Setup close button event listener when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        const closeBtn = document.getElementById('closeProfileModal');
        if (closeBtn) {
          closeBtn.addEventListener('click', closeProfileModal);
        }
        // Also close when clicking outside modal
        const modal = document.getElementById('profileModal');
        if (modal) {
          modal.addEventListener('click', (e) => {
            if (e.target === modal) {
              closeProfileModal();
            }
          });
        }
      });
    } else {
      const closeBtn = document.getElementById('closeProfileModal');
      if (closeBtn) {
        closeBtn.addEventListener('click', closeProfileModal);
      }
      // Also close when clicking outside modal
      const modal = document.getElementById('profileModal');
      if (modal) {
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            closeProfileModal();
          }
        });
      }
    }
    
    // Advanced Settings Modal Functions
    function openAdvancedSettings() {
      const modal = document.getElementById('advancedSettingsModal');
      if (modal) {
        modal.style.display = 'flex';
        loadAdvancedSettingsData();
      }
    }

    function closeAdvancedSettings() {
      const modal = document.getElementById('advancedSettingsModal');
      if (modal) {
        modal.style.display = 'none';
      }
    }

    async function loadAdvancedSettingsData() {
      try {
        // Load account information
        if (window.auth && window.auth.currentUser) {
          const user = window.auth.currentUser;
          const userIdEl = document.getElementById('advancedUserId');
          const emailEl = document.getElementById('advancedUserEmail');
          
          if (userIdEl) userIdEl.textContent = user.uid.substring(0, 20) + '...';
          if (emailEl) emailEl.textContent = user.email || 'N/A';

          // Load user document for member since and last login
          if (window.db) {
            try {
              const { doc, getDoc } = await import('https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js');
              const userRef = doc(window.db, 'users', user.uid);
              const userDoc = await getDoc(userRef);
              
              if (userDoc.exists()) {
                const data = userDoc.data();
                const memberSinceEl = document.getElementById('advancedMemberSince');
                const lastLoginEl = document.getElementById('advancedLastLogin');
                
                if (memberSinceEl && data.joined) {
                  memberSinceEl.textContent = new Date(data.joined).toLocaleDateString();
                }
                if (lastLoginEl && data.lastLogin) {
                  lastLoginEl.textContent = new Date(data.lastLogin).toLocaleDateString();
                }
              }
            } catch (e) {
              console.error('[Advanced Settings] Error loading user data:', e);
            }
          }
        }

        // Load statistics
        await loadStatistics();
      } catch (error) {
        console.error('[Advanced Settings] Error loading data:', error);
      }
    }

    async function loadStatistics() {
      try {
        let dataCount = 0;
        let storageSize = 0;

        // Count data entries if DataService is available
        if (window.DataService && window.auth && window.auth.currentUser) {
          try {
            const debts = await window.DataService.getDebts();
            const budgets = await window.DataService.getBudgets ? await window.DataService.getBudgets() : [];
            const savings = await window.DataService.getSavingsGoals();
            
            dataCount = (debts?.length || 0) + (budgets?.length || 0) + (savings?.length || 0);
          } catch (e) {
            console.error('[Advanced Settings] Error counting data:', e);
          }
        }

        // Calculate storage size
        try {
          const storage = JSON.stringify(localStorage);
          storageSize = new Blob([storage]).size;
        } catch (e) {
          console.error('[Advanced Settings] Error calculating storage:', e);
        }

        // Update UI
        const dataEntriesEl = document.getElementById('statsDataEntries');
        const storageUsedEl = document.getElementById('statsStorageUsed');
        
        if (dataEntriesEl) dataEntriesEl.textContent = dataCount;
        if (storageUsedEl) {
          const sizeKB = (storageSize / 1024).toFixed(2);
          storageUsedEl.textContent = sizeKB + ' KB';
        }

        // Cache size (placeholder)
        const cacheSizeEl = document.getElementById('statsCacheSize');
        if (cacheSizeEl) {
          cacheSizeEl.textContent = 'N/A';
        }
      } catch (error) {
        console.error('[Advanced Settings] Error loading statistics:', error);
      }
    }

    // Data Export Functions
    async function exportAllData() {
      try {
        if (!window.auth || !window.auth.currentUser || !window.DataService) {
          alert('Please log in to export data.');
          return;
        }

        const data = {
          exportDate: new Date().toISOString(),
          user: {
            email: window.auth.currentUser.email,
            uid: window.auth.currentUser.uid
          },
          data: {}
        };

        // Export debts
        try {
          data.data.debts = await window.DataService.getDebts();
        } catch (e) {
          console.error('Error exporting debts:', e);
          data.data.debts = [];
        }

        // Export savings goals
        try {
          data.data.savingsGoals = await window.DataService.getSavingsGoals();
        } catch (e) {
          console.error('Error exporting savings:', e);
          data.data.savingsGoals = [];
        }

        // Export budgets if available
        if (window.DataService.getBudgets) {
          try {
            data.data.budgets = await window.DataService.getBudgets();
          } catch (e) {
            console.error('Error exporting budgets:', e);
            data.data.budgets = [];
          }
        }

        // Create download
        const jsonStr = JSON.stringify(data, null, 2);
        const blob = new Blob([jsonStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `finance-data-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        alert('Data exported successfully!');
      } catch (error) {
        console.error('[Advanced Settings] Error exporting data:', error);
        alert('Error exporting data. Please try again.');
      }
    }

    async function exportDataAsCSV() {
      try {
        if (!window.auth || !window.auth.currentUser || !window.DataService) {
          alert('Please log in to export data.');
          return;
        }

        let csvContent = 'Type,Name,Balance,Interest Rate,Min Payment,Date\n';

        // Export debts as CSV
        try {
          const debts = await window.DataService.getDebts();
          debts.forEach(debt => {
            csvContent += `Debt,"${debt.name || ''}",${debt.balance || 0},${debt.interestRate || 0},${debt.minPayment || 0},"${debt.date || ''}"\n`;
          });
        } catch (e) {
          console.error('Error exporting debts to CSV:', e);
        }

        // Create download
        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `finance-data-${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        alert('Data exported as CSV successfully!');
      } catch (error) {
        console.error('[Advanced Settings] Error exporting CSV:', error);
        alert('Error exporting data. Please try again.');
      }
    }

    async function importData(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = async (e) => {
        try {
          const content = e.target.result;
          const isJSON = file.name.endsWith('.json');
          
          if (isJSON) {
            const data = JSON.parse(content);
            if (data.data && data.data.debts && window.DataService) {
              // Import debts
              for (const debt of data.data.debts) {
                try {
                  await window.DataService.addDebt(debt);
                } catch (err) {
                  console.error('Error importing debt:', err);
                }
              }
              alert('Data imported successfully! Please refresh the page.');
            }
          } else {
            // CSV import would go here
            alert('CSV import is not yet implemented.');
          }
        } catch (error) {
          console.error('[Advanced Settings] Error importing data:', error);
          alert('Error importing data. Please check the file format.');
        }
      };
      reader.readAsText(file);
      event.target.value = ''; // Reset input
    }

    // Cache Management Functions
    function clearLocalStorage() {
      if (confirm('Are you sure you want to clear all local storage? This will remove cached preferences but not your account data.')) {
        localStorage.clear();
        alert('Local storage cleared successfully!');
        location.reload();
      }
    }

    async function clearCache() {
      if (confirm('Are you sure you want to clear the app cache? This may require reloading the page.')) {
        try {
          if ('caches' in window) {
            const cacheNames = await caches.keys();
            await Promise.all(cacheNames.map(name => caches.delete(name)));
            alert('Cache cleared successfully! The page will reload.');
            location.reload();
          } else {
            alert('Cache API not available in this browser.');
          }
        } catch (error) {
          console.error('[Advanced Settings] Error clearing cache:', error);
          alert('Error clearing cache. Please try again.');
        }
      }
    }

    async function unregisterServiceWorker() {
      if (confirm('Are you sure you want to reset the service worker? The page will reload.')) {
        try {
          if ('serviceWorker' in navigator) {
            const registrations = await navigator.serviceWorker.getRegistrations();
            await Promise.all(registrations.map(reg => reg.unregister()));
            alert('Service worker unregistered. The page will reload.');
            location.reload();
          } else {
            alert('Service workers not available in this browser.');
          }
        } catch (error) {
          console.error('[Advanced Settings] Error unregistering service worker:', error);
          alert('Error resetting service worker. Please try again.');
        }
      }
    }

    // Privacy Functions
    function requestDataDeletion() {
      if (confirm('‚ö†Ô∏è WARNING: This will permanently delete all your account data. This action cannot be undone.\n\nAre you absolutely sure?')) {
        alert('Data deletion request has been noted. Please contact support for assistance with permanent data deletion.');
        // In a real app, this would trigger a proper deletion process
      }
    }

    function downloadPrivacyReport() {
      try {
        const report = {
          reportDate: new Date().toISOString(),
          user: window.auth?.currentUser?.email || 'Not logged in',
          dataStored: {
            localStorage: Object.keys(localStorage).length + ' items',
            cache: 'Available',
            serviceWorker: 'Active'
          },
          privacy: {
            dataCollection: 'Minimal - only data you input',
            dataSharing: 'None',
            dataRetention: 'Until account deletion'
          }
        };

        const jsonStr = JSON.stringify(report, null, 2);
        const blob = new Blob([jsonStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `privacy-report-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      } catch (error) {
        console.error('[Advanced Settings] Error generating privacy report:', error);
        alert('Error generating privacy report.');
      }
    }

    // Setup advanced settings modal event listeners
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        const closeBtn = document.getElementById('closeAdvancedSettings');
        if (closeBtn) {
          closeBtn.addEventListener('click', closeAdvancedSettings);
        }
        const modal = document.getElementById('advancedSettingsModal');
        if (modal) {
          modal.addEventListener('click', (e) => {
            if (e.target === modal) {
              closeAdvancedSettings();
            }
          });
        }
      });
    } else {
      const closeBtn = document.getElementById('closeAdvancedSettings');
      if (closeBtn) {
        closeBtn.addEventListener('click', closeAdvancedSettings);
      }
      const modal = document.getElementById('advancedSettingsModal');
      if (modal) {
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            closeAdvancedSettings();
          }
        });
      }
    }

    // Make functions globally available immediately
    window.openProfileModal = openProfileModal;
    window.closeProfileModal = closeProfileModal;
    window.initializeThemeSelector = initializeThemeSelector;
    window.openAdvancedSettings = openAdvancedSettings;
    window.closeAdvancedSettings = closeAdvancedSettings;
    
    // Ensure logout is available globally (fallback if auth.js hasn't loaded it yet)
    (function() {
      // Check if logout is already defined
      if (typeof window.logout === 'function') {
        return; // Already defined, don't override
      }
      
      // Store reference to check later
      const checkForAuthLogout = async function() {
        // Wait a bit for auth.js to load
        for (let i = 0; i < 10; i++) {
          await new Promise(resolve => setTimeout(resolve, 200));
          if (typeof window.logout === 'function' && window.logout !== checkForAuthLogout) {
            // Auth.js loaded, use its logout function
            return;
          }
        }
      };
      
      // Set fallback logout function
      window.logout = async function() {
        // First check if real auth.js logout is available now
        await checkForAuthLogout();
        if (typeof window.logout === 'function' && window.logout !== arguments.callee) {
          // Call the real logout from auth.js
          return window.logout();
        }
        
        // Fallback: clear storage and redirect to landing page
        console.log('[Logout] Using fallback logout function');
        try {
          if (window.auth && typeof window.auth.signOut === 'function') {
            await window.auth.signOut();
          }
        } catch (e) {
          console.warn('[Logout] Error signing out from auth:', e);
        }
        sessionStorage.clear();
        localStorage.clear();
        window.location.href = '/index.html';
      };
    })();
    
    // Functions already made globally available above
  </script>
  
  <!-- Dashboard Stats Loading Script -->
  <script>
    // Load dashboard stats when page loads
    async function loadDashboardStats() {
      try {
        // Wait for DataService to be available (don't wait for auth - stats can load without auth)
        let attempts = 0;
        while (!window.DataService && attempts < 20) {
          await new Promise(resolve => setTimeout(resolve, 250));
          attempts++;
        }
        
        if (!window.DataService) {
          console.warn('DataService not available yet, showing default values');
          updateStatValue('creditUtilizationValue', 'N/A');
          updateStatValue('netWorthValue', '$0.00');
          updateStatValue('debtSummaryValue', '$0.00');
          updateStatValue('savingsValue', '$0.00');
          return;
        }
        
        // Check if user is authenticated - only load data if authenticated
        // DataService will throw errors if user is not authenticated, so catch those
        const isAuthenticated = window.auth && window.auth.currentUser;
        
        // Only load data if user is authenticated
        if (!isAuthenticated) {
          console.log('User not authenticated, showing default values');
          updateStatValue('creditUtilizationValue', 'N/A');
          updateStatValue('netWorthValue', '$0.00');
          updateStatValue('debtSummaryValue', '$0.00');
          updateStatValue('savingsValue', '$0.00');
          return;
        }
        
        // Load debts for debt summary
        try {
          const debts = await window.DataService.getDebts();
          const totalDebt = debts.reduce((sum, debt) => sum + (debt.balance || 0), 0);
          updateStatValue('debtSummaryValue', window.DataService.formatCurrency(totalDebt));
        } catch (error) {
          // Silently fail if user not authenticated or other error
          if (!error.message.includes('not authenticated')) {
            console.error('Error loading debts:', error);
          }
          updateStatValue('debtSummaryValue', '$0.00');
        }
        
        // Load net worth
        try {
          const netWorth = await window.DataService.getNetWorth();
          if (netWorth) {
            const netWorthValue = (netWorth.assets || 0) - (netWorth.liabilities || 0);
            updateStatValue('netWorthValue', window.DataService.formatCurrency(netWorthValue));
          } else {
            updateStatValue('netWorthValue', '$0.00');
          }
        } catch (error) {
          // Silently fail if user not authenticated or other error
          if (!error.message.includes('not authenticated')) {
            console.error('Error loading net worth:', error);
          }
          updateStatValue('netWorthValue', '$0.00');
        }
        
        // Load savings goals for savings progress
        try {
          const savingsGoals = await window.DataService.getSavingsGoals();
          if (savingsGoals && savingsGoals.length > 0) {
            const totalCurrent = savingsGoals.reduce((sum, goal) => sum + (goal.currentAmount || 0), 0);
            const totalTarget = savingsGoals.reduce((sum, goal) => sum + (goal.targetAmount || 0), 0);
            updateStatValue('savingsValue', window.DataService.formatCurrency(totalCurrent) + ' / ' + window.DataService.formatCurrency(totalTarget));
          } else {
            updateStatValue('savingsValue', '$0.00');
          }
        } catch (error) {
          // Silently fail if user not authenticated or other error
          if (!error.message.includes('not authenticated')) {
            console.error('Error loading savings goals:', error);
          }
          updateStatValue('savingsValue', '$0.00');
        }
        
        // Credit utilization - placeholder for now (would need credit data)
        updateStatValue('creditUtilizationValue', 'N/A');
        
      } catch (error) {
        console.error('Error loading dashboard stats:', error);
        // Set default values on error
        updateStatValue('creditUtilizationValue', 'N/A');
        updateStatValue('netWorthValue', '$0.00');
        updateStatValue('debtSummaryValue', '$0.00');
        updateStatValue('savingsValue', '$0.00');
      }
    }
    
    function updateStatValue(elementId, value) {
      const element = document.getElementById(elementId);
      if (element) {
        element.innerHTML = value;
      }
    }
    
    // Load stats when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        setTimeout(loadDashboardStats, 1000); // Wait 1 second for all scripts to load
      });
    } else {
      setTimeout(loadDashboardStats, 1000);
    }
    
    // Also try loading after a longer delay in case scripts are still loading
    setTimeout(loadDashboardStats, 3000);
  </script>
  
</body>
</html>
